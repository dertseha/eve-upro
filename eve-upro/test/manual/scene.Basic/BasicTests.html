<html>
<head>
   <meta http-equiv="X-UA-Compatible" content="IE=9"/>

   <title>upro - Basic Scene Test</title>

   <script type="text/javascript" charset="utf-8" src="http://localhost:3000/javascripts/debug/glMatrix.js"></script>
   <script type="text/javascript" charset="utf-8" src="http://localhost:3000/javascripts/debug/prototype.js"></script>
   <script type="text/javascript" charset="utf-8" src="http://localhost:3000/javascripts/debug/puremvc-multicore-prototypejs-1.0.js"></script>
   <script type="text/javascript" charset="utf-8" src="http://localhost:3000/javascripts/debug/raphael.js"></script>
   <script type="text/javascript" charset="utf-8" src="http://localhost:3000/javascripts/debug/scale.raphael.js"></script>

   <script type="text/javascript" charset="utf-8" src="http://localhost:3000/javascripts/upro.js"></script>

   <script type="text/javascript" charset="utf-8" src="BasicScene.js"></script>
   <script type="text/javascript" charset="utf-8" src="IdleOperation.js"></script>
   <script type="text/javascript" charset="utf-8" src="CameraMoveOperation.js"></script>
   <script type="text/javascript" charset="utf-8" src="CameraRotationOperation.js"></script>
   <script type="text/javascript" charset="utf-8" src="TestCube.js"></script>

   <script type="x-shader/x-vertex" charset="utf-8" id="basic-vertex-shader">
      #ifdef GL_ES
      precision highp float;
      #endif

      varying vec3 vColor;

      uniform mat4 uMVMatrix;
      uniform mat4 uPMatrix;

      attribute vec3 aPosition;
      attribute vec3 aColor;

      void main(void)
      {
         vec4 pos4 = uPMatrix * uMVMatrix * vec4(aPosition, 1.0);

         gl_Position = pos4;

         gl_PointSize = 1.0;
         vColor = aColor;
      }
   </script>

   <script type="x-shader/x-fragment" charset="utf-8" id="basic-fragment-shader">
      #ifdef GL_ES
      precision highp float;
      #endif

      uniform vec3 uColor;
      varying vec3 vColor;

      void main(void)
      {
         gl_FragColor = vec4(vColor, 1.0);
      }
   </script>

<style type="text/css">
      *
      {
         padding: 0;
         margin: 0;
         cursor: none;
      }
      body
      {
         background-color: black
      }
      #scene
      {
         z-index: -1;
         position: absolute;
         top: 0px;
         left: 0px;
      }
      #hud
      {
         z-index: 1;
         position: absolute;
         top: 0px;
         left: 0px;
      }
   </style>

</head>
<body>
   <canvas id="scene"></canvas>
   <div id="hud"></div>
   <script>

      function createLabel(y, text)
      {
         hudSystem.paper.text(200, y, text).attr({"font-size": 15, "text-anchor": "end", "fill": "#FFF", });
      }

      function setupMouse()
      {
         opRegistry = new upro.sys.PointerOperationRegistry();
         mouseListener = new upro.sys.MouseListener(opRegistry);
      }

      function setupScene()
      {
         sceneContext = new upro.sys.ResizableContextWindow("scene");
         sceneSystem = new upro.scene.SceneSystem(sceneContext);

      }

      function setupHud()
      {
         hudContext = new upro.sys.ResizableContextWindow("hud");
         hudSystem = new upro.hud.HudSystem(hudContext);
      }

      document.observe("dom:loaded", function()
      {
         setupMouse();
         setupHud();

         if (upro.scene.SceneSystem.SUPPORTED)
         {
            hudSystem.debugMessage("WebGL supported, starting system");
            hudSystem.debugMessage("Right Mouse Button & Move: Translate");
            hudSystem.debugMessage("Left Mouse Button & Move: Rotate");
            hudSystem.debugMessage("Mouse operations:");
            hudSystem.debugMessage("Press button on side to reset scene");
            setupScene();
            testScene();
         }
         else
         {
            hudSystem.debugMessage("This browser does not support WebGL.");
         }
      });
   </script>
</body>
</html>
